<!-- Test simple para probar solo el botón -->
{% extends 'base.html' %}

{% block title %}Test Simple - Notificaciones{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Test Simple del Botón de Notificaciones</h2>
    
    <div class="alert alert-info">
        <p><strong>Usuario:</strong> {{ user.username }} | <strong>Notificaciones:</strong> {{ unread_notifications_count }}</p>
    </div>
    
    <!-- Botón de notificaciones simplificado -->
    <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle" type="button" id="simpleNotificationDropdown" data-bs-toggle="dropdown">
            <i class="fas fa-bell"></i> Notificaciones
            <span class="badge bg-danger ms-2">{{ unread_notifications_count }}</span>
        </button>
        
        <div class="dropdown-menu dropdown-menu-end" style="width: 300px;" id="simpleDropdownContent">
            <div class="dropdown-header">Cargando...</div>
        </div>
    </div>
    
    <div class="mt-4">
        <h4>Test directo con botón</h4>
        <button id="directTestBtn" class="btn btn-success">Test Directo AJAX</button>
        <div id="directResult" class="mt-2 border p-2" style="min-height: 100px;"></div>
    </div>
</div>

<script>
// Test directo con AJAX
document.getElementById('directTestBtn').addEventListener('click', function() {
    console.log('Botón clickeado');
    
    fetch('/notifications/dropdown-simple/')
        .then(response => {
            console.log('Status:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('Data received:', data);
            if (data.success) {
                document.getElementById('directResult').innerHTML = data.html;
            } else {
                document.getElementById('directResult').innerHTML = '<div class="alert alert-danger">Error: ' + data.error + '</div>';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('directResult').innerHTML = '<div class="alert alert-danger">Error de red: ' + error.message + '</div>';
        });
});

// Para el dropdown de Bootstrap
document.getElementById('simpleNotificationDropdown').addEventListener('click', function() {
    console.log('Dropdown clickeado');
    
    fetch('/notifications/dropdown-simple/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('simpleDropdownContent').innerHTML = data.html;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('simpleDropdownContent').innerHTML = '<div class="dropdown-item text-danger">Error al cargar</div>';
        });
});
</script>
{% endblock %}