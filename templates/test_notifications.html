<!-- Test template para debuggear las notificaciones -->
{% extends 'base.html' %}

{% block title %}Test Notificaciones{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Test del Sistema de Notificaciones</h2>
    
    <div class="row">
        <div class="col-md-6">
            <h4>Información del Usuario</h4>
            <p><strong>Usuario:</strong> {{ user.username }}</p>
            <p><strong>Autenticado:</strong> {{ user.is_authenticated }}</p>
            <p><strong>Notificaciones no leídas:</strong> {{ unread_notifications_count }}</p>
        </div>
        
        <div class="col-md-6">
            <h4>Test de URLs</h4>
            <p><a href="{% url 'notifications:list' %}" class="btn btn-primary">Ver todas las notificaciones</a></p>
            <p><a href="{% url 'notifications:dropdown' %}" class="btn btn-secondary">Test Dropdown AJAX</a></p>
        </div>
    </div>
    
    <div class="mt-4">
        <h4>Test Manual del Dropdown</h4>
        <button id="testDropdownBtn" class="btn btn-info">Cargar Notificaciones Manualmente</button>
        <div id="testResult" class="mt-3 border p-3" style="min-height: 200px;">
            <!-- El contenido aparecerá aquí -->
        </div>
    </div>
</div>

<script>
document.getElementById('testDropdownBtn').addEventListener('click', function() {
    const resultDiv = document.getElementById('testResult');
    resultDiv.innerHTML = 'Cargando...';
    
    fetch('{% url "notifications:dropdown" %}')
        .then(response => {
            console.log('Response status:', response.status);
            return response.text();
        })
        .then(html => {
            console.log('Received HTML:', html);
            resultDiv.innerHTML = html;
        })
        .catch(error => {
            console.error('Error:', error);
            resultDiv.innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
        });
});
</script>
{% endblock %}